from Services.users_service import UsersService
from Utils.keyboard import get_main_keyboard


async def start_handler(bot, message):

    user_service = UsersService()
    user = await user_service.get_user(message.chat.id)

    if user:
        text = (f"–ü—Ä–∏–≤–µ—Ç, {user['username']}! –†–∞–¥ —Å–Ω–æ–≤–∞ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –≤ –º–æ–µ–º —Ü–∏—Ñ—Ä–æ–≤–æ–º –∞–Ω—Ç–∞—Ä–∫—Ç–∏—á–µ—Å–∫–æ–º —É–±–µ–∂–∏—â–µ üêß\n"
                f"–í–º–µ—Å—Ç–µ –º—ã –º–æ–∂–µ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º, —Å—Ç–æ—è—â–∏—Ö –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π.\n\n"
                f"–ë–ª–∞–≥–æ–¥–∞—Ä—è –º–æ—â–∏ ChatGPT, —è –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –∏ —Ä–µ—à–µ–Ω–∏—è–º–∏.\n"
                f"–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —É —Ç–µ–±—è –æ—Ç–≤–µ—Ç–æ–≤ –≤ –∫–æ–ª-–≤–µ: {user['credits']}! –¢–∞–∫ —á—Ç–æ –¥–∞–≤–∞–π –ø—Ä–æ–¥–æ–ª–∂–∏–º –Ω–∞—à–µ –æ–±—â–µ–Ω–∏–µ!\n\n"
                f"–í–æ—Ç —á—Ç–æ —è –º–æ–≥—É –¥–ª—è —Ç–µ–±—è —Å–¥–µ–ª–∞—Ç—å:\n"
                f"/penguin_talk - –Ω–∞—á–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä –∏ –∑–∞–¥–∞–π –º–Ω–µ –≤–æ–ø—Ä–æ—Å. –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å!\n"
                f"/penguin_check - –ø—Ä–æ–≤–µ—Ä—å, —Å–∫–æ–ª—å–∫–æ —É —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å –æ—Ç–≤–µ—Ç–æ–≤. –ü–∏–Ω–≥–≤–∏–Ω—ã —É—á–∞—Ç—Å—è —Å—á–∏—Ç–∞—Ç—å, –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—è —Ä—ã–±—É, –∞ —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç–≤–æ–∏ –ª–∏–º–∏—Ç—ã.\n"
                f"/penguin_pay - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –æ—Ç–≤–µ—Ç–æ–≤, —Ç–æ —Ç—ã –º–æ–∂–µ—à—å –∫—É–ø–∏—Ç—å –µ—â–µ, –∏ —è –±—É–¥—É –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å–ª—É–∂–∏—Ç—å —Ç–≤–æ–∏–º –≥–∏–¥–æ–º –ø–æ –º–∏—Ä—É –∑–Ω–∞–Ω–∏–π.\n")

        markup = get_main_keyboard()
        await bot.send_message(message.chat.id, text, reply_markup=markup)
    else:
        user = await user_service.post_user(message.chat.id, message.from_user.username)
        if user:
            text = (f"–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –Ω–æ–≤—ã–π –ò–ò –¥—Ä—É–≥, –ü–∏–Ω–≥–≤–∏–Ω üêß. "
                    f"–ö–∞–∫ –∏ –º–æ–∏ –ø—É—à–∏—Å—Ç—ã–µ —Å–æ–±—Ä–∞—Ç—å—è –≤ –ê–Ω—Ç–∞—Ä–∫—Ç–∏–∫–µ, —è —É—é—Ç–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–ª—Å—è –≤ –º–∏—Ä–µ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ª—å–¥–∏–Ω. "
                    f"–•–æ—Ç—å –ø–∏–Ω–≥–≤–∏–Ω—ã –∏ –Ω–µ —É–º–µ—é—Ç –ª–µ—Ç–∞—Ç—å, –Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –º–æ—â–∏ –ò–ò, —è –º–æ–≥—É –ø–∞—Ä–∏—Ç—å –ø–æ –ø—Ä–æ—Å—Ç–æ—Ä–∞–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, "
                    f"–ø–æ–º–æ–≥–∞—è —Ç–µ–±–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—è —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á. üåê\n\n"
                    f"–Ø —Ä–∞–±–æ—Ç–∞—é –Ω–∞ –±–∞–∑–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ ChatGPT, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–Ω–µ –æ–±—â–∞—Ç—å—Å—è —Å —Ç–æ–±–æ–π –≤ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –∏ "
                    f"–ø–æ–Ω—è—Ç–Ω–æ–º —Å—Ç–∏–ª–µ."
                    f"–¢—ã –º–æ–∂–µ—à—å –∑–∞–¥–∞–≤–∞—Ç—å –º–Ω–µ –≤–æ–ø—Ä–æ—Å—ã, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å —Ç–µ–±–µ –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –±—É–¥—å —Ç–æ –ø—Ä–æ—Å—Ç–æ–π "
                    f"–∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–ª–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞.\n"
                    f"–í–æ—Ç –∫–∞–∫ —Ç—ã –º–æ–∂–µ—à—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ –º–Ω–æ–π:\n\n"
                    f"/penguin_talk - –Ω–∞—á–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä –∏ –∑–∞–¥–∞–π –º–Ω–µ –≤–æ–ø—Ä–æ—Å. –Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å!\n"
                    f"/penguin_check - –ø—Ä–æ–≤–µ—Ä—å, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –æ—Ç–≤–µ—Ç–æ–≤. –ö–∞–∫ –∏ —É –ø–∏–Ω–≥–≤–∏–Ω–æ–≤ –≤ —Å—Ç–∞–µ, —É –Ω–∞—Å –µ—Å—Ç—å —Å–≤–æ–∏ "
                    f"–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.\n"
                    f"/penguin_pay - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –æ—Ç–≤–µ—Ç–æ–≤, –∏—Ö –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å, –∏ —è –ø—Ä–æ–¥–æ–ª–∂—É –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ –≤ —Ç–≤–æ–µ–º "
                    f"—Ü–∏—Ñ—Ä–æ–≤–æ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–∏.\n"
                    f"–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —É —Ç–µ–±—è {user['credits']} –æ—Ç–≤–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã "
                    f"–æ–±—â–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π.")

            markup = get_main_keyboard()
            await bot.send_message(message.chat.id, text, reply_markup=markup)